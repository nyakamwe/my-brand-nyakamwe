{"version":3,"sources":["user_test.js"],"names":["require","config","user","autToken","chai","should","use","chaiHttp","describe","before","done","dbURI","process","env","DB_USER","DB_PASSWORD","mongoose","connect","useNewUrlParser","useUnifiedTopology","then","responseult","console","log","catch","error","connection","dropCollection","it","newUser","User","username","email","password","request","server","post","send","end","err","response","have","status","body","be","a","property","eql","after","logInUser","Token"],"mappings":";;AAAA;;AACA;;AACA;;AACA;;AACA;;AAKA;;AACA;;;;AALAA,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAAlB,G,CAGA;;;AAIA,IAAIC,IAAJ,EAAUC,QAAV,C,CAEA;;AACAC,cAAKC,MAAL;;AAEAD,cAAKE,GAAL,CAASC,iBAAT;;AAGAC,QAAQ,CAAC,yBAAD,EAA4B,MAAI;AACpCC,EAAAA,MAAM,CAAC,UAASC,IAAT,EAAe;AAClB;AACJ,UAAMC,KAAK,GAAG,iBAAgBC,OAAO,CAACC,GAAR,CAAYC,OAAQ,IAAGF,OAAO,CAACC,GAAR,CAAYE,WAAY,gFAA7E;;AACAC,sBAASC,OAAT,CAAiBN,KAAjB,EAAuB;AAACO,MAAAA,eAAe,EAAC,IAAjB;AAAuBC,MAAAA,kBAAkB,EAAC;AAA1C,KAAvB,EAAwEC,IAAxE,CAA8EC,WAAD,IAAe;AAEpFC,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AAGAb,MAAAA,IAAI;AAEP,KAPL,EAOOc,KAPP,CAOcC,KAAD,IAAS;AACdH,MAAAA,OAAO,CAACC,GAAR,CAAYE,KAAZ;AACH,KATL;AAaC,GAhBK,CAAN;AAoBA;AACJ;AACA;;AAEKjB,EAAAA,QAAQ,CAAC,iBAAD,EAAoB,MAAI;AAC7BC,IAAAA,MAAM,CAAC,MAAI;AACPO,wBAASU,UAAT,CAAoBC,cAApB,CAAmC,OAAnC;AACH,KAFK,CAAN;AAIAC,IAAAA,EAAE,CAAC,mBAAD,EAAuBlB,IAAD,IAAQ;AAE5B,YAAMmB,OAAO,GAAG,IAAIC,UAAJ,CAAS;AACrBC,QAAAA,QAAQ,EAAC,QADY;AAErBC,QAAAA,KAAK,EAAC,iBAFe;AAGrBC,QAAAA,QAAQ,EAAC;AAHY,OAAT,CAAhB;;AAOA7B,oBAAK8B,OAAL,CAAaC,cAAb,EACCC,IADD,CACM,YADN,EAECC,IAFD,CAEMR,OAFN,EAGCS,GAHD,CAGK,CAACC,GAAD,EAAMC,QAAN,KAAiB;AAClBA,QAAAA,QAAQ,CAACnC,MAAT,CAAgBoC,IAAhB,CAAqBC,MAArB,CAA4B,GAA5B;AACAF,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBuC,EAArB,CAAwBC,CAAxB,CAA0B,QAA1B;AACAL,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBoC,IAArB,CAA0BK,QAA1B,CAAmC,SAAnC,EAA8CC,GAA9C,CAAkD,eAAlD;AACJrC,QAAAA,IAAI;AACH,OARD;AASH,KAlBC,CAAF;AAqBAkB,IAAAA,EAAE,CAAC,aAAD,EAAiBlB,IAAD,IAAQ;AAEtBR,MAAAA,IAAI,GAAG,IAAI4B,UAAJ,CAAS;AACZC,QAAAA,QAAQ,EAAC,QADG;AAEZC,QAAAA,KAAK,EAAC,iBAFM;AAGZC,QAAAA,QAAQ,EAAC;AAHG,OAAT,CAAP;;AAOA7B,oBAAK8B,OAAL,CAAaC,cAAb,EACCC,IADD,CACM,YADN,EAECC,IAFD,CAEMnC,IAFN,EAGCoC,GAHD,CAGK,CAACC,GAAD,EAAMC,QAAN,KAAiB;AAClBA,QAAAA,QAAQ,CAACnC,MAAT,CAAgBoC,IAAhB,CAAqBC,MAArB,CAA4B,GAA5B;AACAF,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBuC,EAArB,CAAwBC,CAAxB,CAA0B,QAA1B;AACAL,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBoC,IAArB,CAA0BK,QAA1B,CAAmC,SAAnC,EAA8CC,GAA9C,CAAkD,qBAAlD;AACJrC,QAAAA,IAAI;AACH,OARD;AAUH,KAnBC,CAAF;AAqBAkB,IAAAA,EAAE,CAAC,kDAAD,EAAsDlB,IAAD,IAAQ;AAE3D,YAAMR,IAAI,GAAG,IAAI4B,UAAJ,CAAS;AAClBC,QAAAA,QAAQ,EAAC,EADS;AAElBC,QAAAA,KAAK,EAAC,EAFY;AAGlBC,QAAAA,QAAQ,EAAC;AAHS,OAAT,CAAb;;AAOA7B,oBAAK8B,OAAL,CAAaC,cAAb,EACCC,IADD,CACM,YADN,EAECC,IAFD,CAEMnC,IAFN,EAGCoC,GAHD,CAGK,CAACC,GAAD,EAAMC,QAAN,KAAiB;AAClBA,QAAAA,QAAQ,CAACnC,MAAT,CAAgBoC,IAAhB,CAAqBC,MAArB,CAA4B,GAA5B;AACAF,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBuC,EAArB,CAAwBC,CAAxB,CAA0B,QAA1B;AACAL,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBoC,IAArB,CAA0BK,QAA1B,CAAmC,SAAnC,EAA8CC,GAA9C,CAAkD,yBAAlD;AACJrC,QAAAA,IAAI;AACH,OARD;AASH,KAlBC,CAAF;AAoBH,GAnEQ,CAAR;AAqED;AACJ;AACA;;AAEKF,EAAAA,QAAQ,CAAC,uBAAD,EAA0B,MAAI;AAClCwC,IAAAA,KAAK,CAAC,MAAI;AACNhC,wBAASU,UAAT,CAAoBC,cAApB,CAAmC,OAAnC;AACH,KAFI,CAAL;AAID,UAAMsB,SAAS,GAAG;AACdlB,MAAAA,QAAQ,EAAC,QADK;AAEdE,MAAAA,QAAQ,EAAC;AAFK,KAAlB;AAKAL,IAAAA,EAAE,CAAC,cAAD,EAAkBlB,IAAD,IAAQ;AACvBN,oBAAK8B,OAAL,CAAaC,cAAb,EACCC,IADD,CACM,kBADN,EAECC,IAFD,CAEM;AAACN,QAAAA,QAAQ,EAACkB,SAAS,CAAClB,QAApB;AAA8BE,QAAAA,QAAQ,EAACgB,SAAS,CAAChB;AAAjD,OAFN,EAGCK,GAHD,CAGK,UAASC,GAAT,EAAcC,QAAd,EAAwB;AACzB,YAAID,GAAJ,EAAS,OAAO7B,IAAI,CAAC6B,GAAD,CAAX;AAETC,QAAAA,QAAQ,CAACnC,MAAT,CAAgBoC,IAAhB,CAAqBC,MAArB,CAA4B,GAA5B;AACAF,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBuC,EAArB,CAAwBC,CAAxB,CAA0B,QAA1B;AACA1C,QAAAA,QAAQ,GAAGqC,QAAQ,CAACG,IAAT,CAAcO,KAAzB;AAEAxC,QAAAA,IAAI;AACP,OAXD;AAaH,KAdC,CAAF;AAgBAkB,IAAAA,EAAE,CAAC,6CAAD,EAAiDlB,IAAD,IAAQ;AACtD,YAAMuC,SAAS,GAAG;AACdlB,QAAAA,QAAQ,EAAC,QADK;AAEdE,QAAAA,QAAQ,EAAC;AAFK,OAAlB;;AAIA7B,oBAAK8B,OAAL,CAAaC,cAAb,EACCC,IADD,CACM,kBADN,EAECC,IAFD,CAEM;AAACN,QAAAA,QAAQ,EAACkB,SAAS,CAAClB,QAApB;AAA8BE,QAAAA,QAAQ,EAACgB,SAAS,CAAChB;AAAjD,OAFN,EAGCK,GAHD,CAGK,UAASC,GAAT,EAAcC,QAAd,EAAwB;AACzB,YAAID,GAAJ,EAAS,OAAO7B,IAAI,CAAC6B,GAAD,CAAX;AAETC,QAAAA,QAAQ,CAACnC,MAAT,CAAgBoC,IAAhB,CAAqBC,MAArB,CAA4B,GAA5B;AACAF,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBuC,EAArB,CAAwBC,CAAxB,CAA0B,QAA1B;AACAL,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBoC,IAArB,CAA0BK,QAA1B,CAAmC,SAAnC,EAA8CC,GAA9C,CAAkD,+BAAlD;AACJrC,QAAAA,IAAI;AACH,OAVD;AAYH,KAjBC,CAAF;AAmBAkB,IAAAA,EAAE,CAAC,0BAAD,EAA8BlB,IAAD,IAAQ;AACnC,YAAMuC,SAAS,GAAG;AACdlB,QAAAA,QAAQ,EAAC,WADK;AAEdE,QAAAA,QAAQ,EAAC;AAFK,OAAlB;;AAIA7B,oBAAK8B,OAAL,CAAaC,cAAb,EACCC,IADD,CACM,kBADN,EAECC,IAFD,CAEM;AAACN,QAAAA,QAAQ,EAACkB,SAAS,CAAClB,QAApB;AAA8BE,QAAAA,QAAQ,EAACgB,SAAS,CAAChB;AAAjD,OAFN,EAGCK,GAHD,CAGK,UAASC,GAAT,EAAcC,QAAd,EAAwB;AACzB,YAAID,GAAJ,EAAS,OAAO7B,IAAI,CAAC6B,GAAD,CAAX;AAETC,QAAAA,QAAQ,CAACnC,MAAT,CAAgBoC,IAAhB,CAAqBC,MAArB,CAA4B,GAA5B;AACAF,QAAAA,QAAQ,CAACG,IAAT,CAActC,MAAd,CAAqBoC,IAArB,CAA0BK,QAA1B,CAAmC,SAAnC,EAA8CC,GAA9C,CAAkD,WAAlD;AACJrC,QAAAA,IAAI;AACH,OATD;AAWH,KAhBC,CAAF;AAoBH,GAjEQ,CAAR;AAmEJ,CArKO,CAAR","sourceRoot":"/home/nyakamwe/Desktop/my-brand-nyakamwe/server/src/test/","sourcesContent":["import mongoose from 'mongoose';\nimport chai from 'chai';\nimport server from \"../index\";\nimport chaiHttp from \"chai-http\";\nimport {Post} from \"../models/Post\";\nrequire(\"dotenv\").config();\n\n\n//to mock a function during testing\nimport sinon from 'sinon'\nimport { User } from '../models/User';\n\nlet user, autToken;\n\n//assertion style\nchai.should();\n\nchai.use(chaiHttp)  \n    \n    \ndescribe('Test for User Endpoints', ()=>{\n    before(function(done) {\n        // Connect to MongoDB database\n    const dbURI =`mongodb+srv://${process.env.DB_USER}:${process.env.DB_PASSWORD}@node-applications.fe4au.mongodb.net/node-tutorial?retryWrites=true&w=majority`\n    mongoose.connect(dbURI,{useNewUrlParser:true, useUnifiedTopology:true}).then((responseult)=>{\n\n            console.log('Db Connected!')\n            \n\n            done();\n            \n        }).catch((error)=>{\n            console.log(error)\n        })\n    \n     \n\n    });\n    \n    \n\n    /**\n     * Test create new user\n     */\n\n     describe('POST /api/users', ()=>{\n        before(()=>{\n            mongoose.connection.dropCollection(\"users\");\n        })\n\n        it('creates new user ', (done)=>{\n\n            const newUser = new User({\n                username:\"menase\",\n                email:\"menase@mail.com\",\n                password:\"password test\"\n           \n            })\n\n            chai.request(server)\n            .post(\"/api/users\")\n            .send(newUser)\n            .end((err, response)=>{\n                response.should.have.status(201);\n                response.body.should.be.a('object');\n                response.body.should.have.property('message').eql(\"user created!\");\n            done();   \n            })\n        })\n\n\n        it('User exists', (done)=>{\n\n            user = new User({\n                username:\"menase\",\n                email:\"menase@mail.com\",\n                password:\"password test\"\n           \n            })\n\n            chai.request(server)\n            .post(\"/api/users\")\n            .send(user)\n            .end((err, response)=>{\n                response.should.have.status(403);\n                response.body.should.be.a('object');\n                response.body.should.have.property('message').eql(\"user already exists\");\n            done();   \n            })\n\n        })\n\n        it('No new user without username, email or password ', (done)=>{\n\n            const user = new User({\n                username:\"\",\n                email:\"\",\n                password:\"\"\n           \n            })\n\n            chai.request(server)\n            .post(\"/api/users\")\n            .send(user)\n            .end((err, response)=>{\n                response.should.have.status(403);\n                response.body.should.be.a('object');\n                response.body.should.have.property('message').eql(\"All fields are required\");\n            done();   \n            })\n        })\n\n    })\n\n    /**\n     * POST User login\n     */\n\n     describe('POST /api/users/login', ()=>{\n         after(()=>{\n             mongoose.connection.dropCollection('users')\n         })\n       \n        const logInUser = {\n            username:'menase',\n            password:'password test'\n        }\n\n        it('login a user', (done)=>{\n            chai.request(server)\n            .post('/api/users/login')\n            .send({username:logInUser.username, password:logInUser.password})\n            .end(function(err, response) {\n                if (err) return done(err);\n\n                response.should.have.status(200);\n                response.body.should.be.a('object');\n                autToken = response.body.Token\n                \n                done();\n            });\n\n        })\n\n        it('not login a user with incorrect credentials', (done)=>{\n            const logInUser = {\n                username:'menase',\n                password:'password'\n            }\n            chai.request(server)\n            .post('/api/users/login')\n            .send({username:logInUser.username, password:logInUser.password})\n            .end(function(err, response) {\n                if (err) return done(err);\n\n                response.should.have.status(403);\n                response.body.should.be.a('object');\n                response.body.should.have.property('message').eql(\"Invalid username or password.\");\n            done();   \n            });\n\n        })\n\n        it('not login anonymous user', (done)=>{\n            const logInUser = {\n                username:'hereweare',\n                password:'hereweare'\n            }\n            chai.request(server)\n            .post('/api/users/login')\n            .send({username:logInUser.username, password:logInUser.password})\n            .end(function(err, response) {\n                if (err) return done(err);\n\n                response.should.have.status(400);\n                response.body.should.have.property('message').eql(\"Not User.\");\n            done();   \n            });\n\n        })\n\n\n       \n    })\n\n})    "]}